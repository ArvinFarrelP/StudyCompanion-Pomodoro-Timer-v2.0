<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Pomodoro Timer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'soft-mint': '#a8e6cf',
                        'light-mint': '#d4f1e6',
                        'soft-coral': '#ffaaa5',
                        'soft-gray': '#5a5a5a',
                        'anime-blue': '#87CEEB',
                        'anime-pink': '#FFB6C1',
                        'anime-purple': '#D8BFD8',
                        'theme-blue-200': '#bfdbfe',
                        'theme-pink-200': '#fecaca',
                        'theme-purple-200': '#e9d5ff',
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'bounce-soft': 'bounce-soft 2s ease-in-out infinite',
                        'pulse-glow': 'pulse-glow 2s ease-in-out infinite',
                        'slide-down': 'slide-down 0.3s ease-out',
                        'slide-up': 'slide-up 0.3s ease-out',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        'bounce-soft': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-8px)' },
                        },
                        'pulse-glow': {
                            '0%, 100%': { opacity: '1', boxShadow: '0 0 20px rgba(255,255,255,0.5)' },
                            '50%': { opacity: '0.8', boxShadow: '0 0 30px rgba(255,255,255,0.8)' },
                        },
                        'slide-down': {
                            '0%': { opacity: '0', transform: 'translateY(-10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        'slide-up': {
                            '0%': { opacity: '1', transform: 'translateY(0)' },
                            '100%': { opacity: '0', transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap');
        
        * {
            font-family: 'Nunito', sans-serif;
            box-sizing: border-box;
        }

        html, body {
            max-width: 100%;
            overflow-x: hidden;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px 0 rgba(168, 230, 207, 0.2);
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 20px;
        }

        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 20px;
        }

        .progress-ring {
            transform: rotate(-90deg);
        }

        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease;
        }

        .control-btn {
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        .video-fallback {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #d4f1e6 0%, #a8e6cf 100%);
            color: #5a5a5a;
            text-align: center;
            z-index: 5;
            border-radius: 20px;
        }

        .achievement-badge {
            transition: all 0.3s ease;
        }

        .achievement-badge.unlocked {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .character-companion {
            transition: all 0.5s ease;
        }

        @keyframes character-talk {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .character-talking {
            animation: character-talk 0.5s ease-in-out;
        }

        .theme-transition {
            transition: all 0.5s ease;
        }

        /* Custom theme backgrounds */
        .theme-mint {
            background: linear-gradient(135deg, #d4f1e6 0%, #a8e6cf 50%, #a8e6cf 100%);
        }
        .theme-blue {
            background: linear-gradient(135deg, #bfdbfe 0%, #87CEEB 50%, #87CEEB 100%);
        }
        .theme-pink {
            background: linear-gradient(135deg, #fecaca 0%, #FFB6C1 50%, #FFB6C1 100%);
        }
        .theme-purple {
            background: linear-gradient(135deg, #e9d5ff 0%, #D8BFD8 50%, #D8BFD8 100%);
        }

        /* Interval & Break Buttons */
        .interval-btn, .break-btn {
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.3);
            border: 2px solid transparent;
            position: relative;
            z-index: 10;
            pointer-events: auto;
            border-radius: 50px;
        }

        .interval-btn:hover, .break-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            border-color: rgba(255, 170, 165, 0.5);
            transform: translateY(-2px);
        }

        .interval-btn.active {
            background: rgba(255, 255, 255, 0.8);
            color: #5a5a5a;
            font-weight: bold;
            border-color: rgba(255, 170, 165, 0.8);
        }

        .break-btn.active {
            background: rgba(255, 170, 165, 0.6);
            color: #5a5a5a;
            font-weight: bold;
            border-color: rgba(255, 170, 165, 0.8);
        }

        /* Character image styling */
        .character-image {
            transition: all 0.3s ease;
            border: 3px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            max-width: 100%;
            height: auto;
        }

        .character-image:hover {
            transform: scale(1.05);
            border-color: rgba(255, 170, 165, 0.8);
        }

        .quote-character-image {
            border: 2px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            max-width: 100%;
            height: auto;
        }

        /* PERBAIKAN: Music Control Styles */
        .music-control-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .music-control-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.7);
            border: 2px solid rgba(255, 255, 255, 0.9);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            z-index: 50;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .music-control-btn:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .music-control-btn.active {
            background: linear-gradient(135deg, #ffaaa5 0%, #a8e6cf 100%);
            border-color: rgba(255, 255, 255, 0.9);
            transform: scale(1.1);
        }

        .music-control-btn.active i {
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .music-control-btn i {
            font-size: 1.1rem;
            color: #5a5a5a;
            transition: all 0.3s ease;
        }

        /* PERBAIKAN: Volume Control yang selalu terlihat - LEBIH JELAS */
        .volume-control-external {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 12px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

.volume-slider-external {
    width: 80px;
    height: 8px;
    border-radius: 4px;
    background: linear-gradient(90deg, #ffaaa5 0%, #a8e6cf 100%);
    outline: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    border: 2px solid rgba(255, 255, 255, 0.8);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}

        .volume-slider-external::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            border: 3px solid #ffaaa5;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }

        .volume-slider-external::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
        }

        .volume-slider-external::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            border: 3px solid #ffaaa5;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .volume-slider-external::-moz-range-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
        }

        .volume-slider-external::-webkit-slider-track {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 4px;
            height: 8px;
        }

        .volume-slider-external::-moz-range-track {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 4px;
            height: 8px;
            border: none;
        }

        .volume-icon-external {
            color: #ffaaa5;
            font-size: 1.1rem;
            min-width: 20px;
            text-align: center;
        }

        /* PERBAIKAN: Progress bar yang lebih jelas */
        .progress-bar-visible {
            height: 10px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.6);
        }

        .progress-bar-visible::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #ffaaa5 0%, #a8e6cf 100%);
            border-radius: 3px;
            width: var(--progress-width, 0%);
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 170, 165, 0.5);
        }

        /* PERBAIKAN: Panel Music yang Lebih Baik - DIPERBAIKI POSISINYA */
        .music-panel {
            position: absolute;
            top: 100%;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.6);
            min-width: 220px;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 10px;
        }

        .music-panel.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        /* PERBAIKAN: Animasi untuk music options */
        .music-option {
            padding: 0.75rem 1rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
            color: #5a5a5a;
            margin-bottom: 0.25rem;
        }

        .music-option:last-child {
            margin-bottom: 0;
        }

        .music-option:hover {
            background: linear-gradient(135deg, rgba(255, 170, 165, 0.2) 0%, rgba(168, 230, 207, 0.2) 100%);
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .music-option.active {
            background: linear-gradient(135deg, #ffaaa5 0%, #a8e6cf 100%);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(255, 170, 165, 0.3);
        }

        .music-option i {
            width: 20px;
            text-align: center;
            font-size: 1rem;
        }

        /* PERBAIKAN BESAR: Timer Container untuk Mobile - DIPERBESAR */
        .timer-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            height: clamp(180px, 45vw, 240px);
            min-height: 180px;
            margin-bottom: 1.5rem;
            padding: 1rem;
            width: 100%;
        }

        .progress-ring {
            position: absolute;
            z-index: 1;
            width: clamp(160px, 40vw, 200px);
            height: clamp(160px, 40vw, 200px);
        }

        .timer-text {
            position: relative;
            z-index: 20;
            text-align: center;
            padding: 0.5rem;
        }

        /* Main Button Styles */
        .main-btn {
            background: linear-gradient(135deg, #ffaaa5 0%, #a8e6cf 100%);
            color: white;
            font-weight: bold;
            border-radius: 50px;
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .main-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        .secondary-btn {
            background: rgba(255, 255, 255, 0.6);
            color: #5a5a5a;
            font-weight: bold;
            border-radius: 50px;
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .secondary-btn:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Splash Screen */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s ease, transform 1s ease;
        }

        .theme-mint #splash-screen {
            background: linear-gradient(135deg, #d4f1e6 0%, #a8e6cf 50%, #a8e6cf 100%);
        }

        .splash-character-container {
            position: relative;
            width: clamp(120px, 40vw, 200px);
            height: clamp(120px, 40vw, 200px);
            margin-bottom: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .splash-character-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 6px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25);
            animation: float-splash 3s ease-in-out infinite;
            background: linear-gradient(135deg, #ffaaa5 0%, #a8e6cf 100%);
        }

        @keyframes float-splash {
            0%, 100% { 
                transform: translateY(0px) rotate(0deg); 
            }
            50% { 
                transform: translateY(-15px) rotate(2deg); 
            }
        }

        .splash-logo {
            font-size: clamp(2rem, 8vw, 3.5rem);
            font-weight: 800;
            margin-bottom: 1.5rem;
            text-align: center;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            letter-spacing: 1px;
        }

        .theme-mint .splash-logo {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffaaa5 25%, #a8e6cf 75%, #4ecdc4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% 200%;
            animation: gradient-shift 3s ease infinite;
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .splash-loader {
            width: clamp(40px, 12vw, 60px);
            height: clamp(40px, 12vw, 60px);
            border-radius: 50%;
            position: relative;
            animation: spin 1.2s linear infinite;
            margin-bottom: 1.5rem;
        }

        .theme-mint .splash-loader {
            border: 4px solid rgba(168, 230, 207, 0.3);
            border-top: 4px solid #ff6b6b;
            border-right: 4px solid #ffaaa5;
            border-bottom: 4px solid #a8e6cf;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .splash-text {
            font-size: clamp(0.9rem, 3.5vw, 1.1rem);
            color: #5a5a5a;
            font-weight: 600;
            text-align: center;
            margin-top: 1rem;
        }

        /* Loading dots animation */
        .loading-dots {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 20px;
        }

        .loading-dots div {
            position: absolute;
            top: 0;
            width: 13px;
            height: 13px;
            border-radius: 50%;
            background: #ff6b6b;
            animation-timing-function: cubic-bezier(0, 1, 1, 0);
        }

        .loading-dots div:nth-child(1) {
            left: 8px;
            animation: loading-dots1 0.6s infinite;
        }

        .loading-dots div:nth-child(2) {
            left: 8px;
            animation: loading-dots2 0.6s infinite;
        }

        .loading-dots div:nth-child(3) {
            left: 32px;
            animation: loading-dots2 0.6s infinite;
        }

        .loading-dots div:nth-child(4) {
            left: 56px;
            animation: loading-dots3 0.6s infinite;
        }

        @keyframes loading-dots1 {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        @keyframes loading-dots2 {
            0% { transform: translate(0, 0); }
            100% { transform: translate(24px, 0); }
        }

        @keyframes loading-dots3 {
            0% { transform: scale(1); }
            100% { transform: scale(0); }
        }

        /* Smooth page transition */
        .page-transition {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page-loaded {
            opacity: 1;
            transform: translateY(0);
        }

        /* Accessibility improvements */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: #000;
            color: white;
            padding: 8px;
            z-index: 10000;
            text-decoration: none;
        }

        .skip-link:focus {
            top: 6px;
        }

        /* Screen reader only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* PERBAIKAN BESAR: Responsive Design yang Lebih Baik untuk Mobile */
        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
                padding-bottom: 2rem;
                overflow-x: hidden;
            }
            
            .glass-card {
                margin: 0.5rem 0;
                padding: 1rem;
                border-radius: 1.5rem;
            }
            
            .text-5xl {
                font-size: 2.5rem;
            }
            
            /* PERBAIKAN KRITIS: Timer container untuk mobile - DIPERBESAR */
            .timer-container {
                height: clamp(160px, 38vw, 200px);
                padding: 0.5rem;
                margin-bottom: 1rem;
            }
            
            .progress-ring {
                width: clamp(140px, 35vw, 180px);
                height: clamp(140px, 35vw, 180px);
            }
            
            .control-btn {
                min-height: 44px;
                min-width: 44px;
            }
            
            .interval-btn, .break-btn {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }
            
            .grid-cols-1 {
                grid-template-columns: 1fr;
            }
            
            .lg\:col-span-2 {
                grid-column: span 1;
            }
            
            .achievement-badge {
                width: 3rem;
                height: 3rem;
            }
            
            .splash-character-container {
                width: 150px;
                height: 150px;
            }
            
            .splash-logo {
                font-size: 2.5rem;
            }
            
            .splash-loader {
                width: 50px;
                height: 50px;
            }

            /* PERBAIKAN: Music panel untuk mobile */
            .music-panel {
                right: -20px;
                min-width: 200px;
            }

            /* PERBAIKAN BESAR: Layout music control untuk mobile */
            .music-control-container {
                flex-direction: row;
                gap: 8px;
                align-items: center;
            }

            .volume-control-external {
                padding: 6px 10px;
                background: rgba(255, 255, 255, 0.9);
            }

            .volume-slider-external {
                width: 70px;
                height: 8px;
            }

            .volume-slider-external::-webkit-slider-thumb {
                width: 18px;
                height: 18px;
            }

            /* PERBAIKAN: Pastikan timer card punya cukup space */
            .space-y-6 > div:first-child {
                margin-top: 0.5rem;
            }

            /* PERBAIKAN: Video header layout untuk mobile */
            .flex.items-center.justify-between.mb-4 {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .music-control-container {
                align-self: flex-end;
                margin-top: -0.5rem;
            }
        }

        @media (max-width: 640px) {
            .flex.justify-between {
                flex-direction: column;
                gap: 1rem;
            }
            
            .theme-btn {
                width: 2.5rem;
                height: 2.5rem;
            }
            
            .flex.justify-center.gap-3 {
                flex-direction: column;
                align-items: center;
                gap: 0.75rem;
            }
            
            .flex.justify-center.gap-3 .control-btn {
                width: 80%;
                max-width: 200px;
            }
            
            .character-companion {
                margin-right: 1rem;
            }
            
            .flex.items-start.gap-3 {
                gap: 0.75rem;
            }
            
            .quote-character-image {
                width: 2rem;
                height: 2rem;
            }

            /* PERBAIKAN: Timer untuk screen kecil - DIPERBESAR */
            .timer-container {
                height: clamp(150px, 32vw, 180px);
            }
            
            .progress-ring {
                width: clamp(130px, 30vw, 160px);
                height: clamp(130px, 30vw, 160px);
            }

            /* PERBAIKAN: Music control lebih compact */
            .music-control-container {
                gap: 6px;
            }

            .volume-control-external {
                padding: 5px 8px;
            }

            .volume-slider-external {
                width: 60px;
            }

            /* PERBAIKAN: Music panel untuk screen kecil */
            .music-panel {
                right: -40px;
                min-width: 180px;
            }
        }

        @media (max-width: 480px) {
            .text-2xl {
                font-size: 1.5rem;
            }
            
            .text-lg {
                font-size: 1.125rem;
            }
            
            /* PERBAIKAN: Timer lebih kecil untuk mobile kecil - DIPERBESAR */
            .timer-container {
                height: clamp(140px, 28vw, 160px);
                padding: 0.25rem;
            }
            
            .progress-ring {
                width: clamp(120px, 26vw, 150px);
                height: clamp(120px, 26vw, 150px);
            }
            
            .text-5xl {
                font-size: 2rem;
            }
            
            .flex.justify-center.gap-2 {
                flex-wrap: wrap;
            }
            
            .interval-btn, .break-btn {
                flex: 1;
                min-width: 0;
                text-align: center;
                font-size: 0.8rem;
                padding: 0.5rem 0.75rem;
            }

            .music-panel {
                right: -60px;
                min-width: 160px;
            }

            /* PERBAIKAN: Kurangi margin untuk hemat space */
            .mb-4 {
                margin-bottom: 1rem;
            }
            
            .mb-6 {
                margin-bottom: 1.5rem;
            }

            /* PERBAIKAN: Music control untuk mobile sangat kecil */
            .music-control-container {
                flex-direction: row;
                gap: 4px;
            }

            .volume-control-external {
                padding: 4px 6px;
            }

            .volume-slider-external {
                width: 50px;
            }

            .music-control-btn {
                width: 40px;
                height: 40px;
            }

            .music-control-btn i {
                font-size: 1rem;
            }
        }

        @media (max-width: 380px) {
            /* PERBAIKAN EXTREME: Untuk device sangat kecil */
            .timer-container {
                height: clamp(130px, 24vw, 150px);
            }
            
            .progress-ring {
                width: clamp(110px, 22vw, 140px);
                height: clamp(110px, 22vw, 140px);
            }
            
            .text-5xl {
                font-size: 1.75rem;
            }
            
            .interval-btn, .break-btn {
                font-size: 0.75rem;
                padding: 0.4rem 0.6rem;
            }

            /* PERBAIKAN: Music control extreme mobile */
            .music-control-container {
                gap: 3px;
            }

            .volume-control-external {
                padding: 3px 5px;
            }

            .volume-slider-external {
                width: 45px;
            }

            /* PERBAIKAN: Layout header untuk mobile extreme */
            .flex.items-center.justify-between.mb-4 {
                gap: 0.5rem;
            }

            .music-control-container {
                margin-top: 0;
            }

            /* PERBAIKAN: Music panel untuk mobile extreme */
            .music-panel {
                right: -80px;
                min-width: 140px;
            }
        }

        @media (max-width: 320px) {
            /* PERBAIKAN: iPhone SE dan device sangat kecil */
            body {
                padding: 0.25rem;
                padding-bottom: 1rem;
            }
            
            .glass-card {
                padding: 0.75rem;
                margin: 0.25rem 0;
                border-radius: 1rem;
            }
            
            .timer-container {
                height: clamp(120px, 20vw, 140px);
                padding: 0.25rem;
                margin-bottom: 0.75rem;
            }
            
            .progress-ring {
                width: clamp(100px, 18vw, 130px);
                height: clamp(100px, 18vw, 130px);
            }
            
            .text-5xl {
                font-size: 1.5rem;
            }
            
            .flex.justify-center.gap-2 {
                gap: 0.25rem;
            }
            
            .interval-btn, .break-btn {
                font-size: 0.7rem;
                padding: 0.35rem 0.5rem;
            }

            .music-control-container {
                flex-wrap: wrap;
                justify-content: center;
                gap: 0.5rem;
            }

            .volume-control-external {
                order: -1;
                width: 100%;
                justify-content: center;
            }

            .music-panel {
                right: -100px;
                min-width: 120px;
            }
        }

        /* Touch optimization */
        @media (hover: none) {
            .control-btn:hover {
                transform: none;
            }
            
            .character-image:hover {
                transform: none;
                border-color: rgba(255, 255, 255, 0.8);
            }
        }

        /* Safe area support untuk notched devices */
        @supports(padding: max(0px)) {
            body {
                padding-left: max(0.5rem, env(safe-area-inset-left));
                padding-right: max(0.5rem, env(safe-area-inset-right));
                padding-top: max(0.5rem, env(safe-area-inset-top));
                padding-bottom: max(0.5rem, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body class="min-h-screen theme-mint py-8 px-4 theme-transition" id="body-theme">
    
    <!-- Accessibility: Skip to main content -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Splash Screen -->
    <div id="splash-screen" class="theme-mint">
        <!-- Character Photo Container -->
        <div class="splash-character-container">
            <img 
                id="splash-character-image" 
                src="./assets/images/TachibanaHikari_and_TachibanaNozomi.jpg" 
                alt="Hikari & Nozomi - Blue Archive" 
                class="splash-character-image"
                onerror="handleSplashImageError()"
            >
        </div>
        
        <!-- Logo -->
        <div class="splash-logo" id="splash-logo">Hikari Blue Archive</div>
        
        <!-- Loading spinner -->
        <div class="splash-loader" aria-hidden="true"></div>
        
        <!-- Loading text dengan dots animation -->
        <p class="splash-text">Loading your Study Companion</p>
        <div class="loading-dots mt-2">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <!-- Floating Background Decorations -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden z-0">
        <div class="absolute top-20 left-10 w-20 h-20 bg-soft-coral/20 rounded-full animate-float blur-xl"></div>
        <div class="absolute top-40 right-20 w-24 h-24 bg-white/30 rounded-full animate-float blur-xl" style="animation-delay: 0.5s;"></div>
        <div class="absolute bottom-32 left-1/4 w-16 h-16 bg-soft-mint/40 rounded-full animate-float blur-xl" style="animation-delay: 1s;"></div>
    </div>

    <!-- Notification -->
    <div id="notification" class="fixed top-6 left-1/2 transform -translate-x-1/2 z-50 hidden">
        <div class="glass-card px-6 py-3 rounded-full shadow-2xl">
            <p class="text-soft-gray font-bold flex items-center gap-2" id="notificationText">
                <i class="fas fa-bell"></i>
                <span></span>
            </p>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div id="achievementPopup" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 hidden">
        <div class="glass-card p-6 rounded-3xl text-center max-w-sm">
            <div class="text-4xl mb-3" id="achievementIcon">üèÜ</div>
            <h3 class="text-xl font-bold text-soft-gray mb-2" id="achievementTitle">Achievement Unlocked!</h3>
            <p class="text-soft-gray/80" id="achievementDesc">You've completed your first session!</p>
        </div>
    </div>

    <!-- Main Container -->
    <main id="main-content" class="max-w-6xl mx-auto space-y-6 relative z-10 page-transition" role="main">
        
        <!-- Header dengan Theme Selector -->
        <header class="glass-card rounded-3xl p-6" role="banner">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-2xl font-bold text-soft-gray">Anime Pomodoro Timer</h1>
                    <p class="text-soft-gray/70">Focus better with anime adventures! ‚ú®</p>
                </div>
                <div class="flex gap-2" role="group" aria-label="Theme selection">
                    <button class="theme-btn w-8 h-8 bg-soft-mint rounded-full border-2 border-white" data-theme="mint" aria-label="Mint theme" aria-pressed="true"></button>
                    <button class="theme-btn w-8 h-8 bg-anime-blue rounded-full" data-theme="blue" aria-label="Blue theme" aria-pressed="false"></button>
                    <button class="theme-btn w-8 h-8 bg-anime-pink rounded-full" data-theme="pink" aria-label="Pink theme" aria-pressed="false"></button>
                    <button class="theme-btn w-8 h-8 bg-anime-purple rounded-full" data-theme="purple" aria-label="Purple theme" aria-pressed="false"></button>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column - Video & Character -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Video Card -->
                <section class="glass-card rounded-3xl p-6 transform hover:scale-[1.01] transition-all duration-300" aria-labelledby="videoTitle">
                    <!-- Video Header dengan Music Control -->
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-soft-coral to-soft-mint rounded-full flex items-center justify-center">
                                <i class="fas fa-play text-white text-sm"></i>
                            </div>
                            <div>
                                <h2 class="text-lg font-bold text-soft-gray" id="videoTitle">Blue Archive - Hikari</h2>
                                <p class="text-xs text-soft-gray/70" id="videoSubtitle">Live2D Animation</p>
                            </div>
                        </div>
                        
                        <!-- PERBAIKAN: Music Control dengan Volume di luar - LEBIH BAIK UNTUK MOBILE -->
                        <div class="music-control-container">
                           <button id="musicControlBtn" class="music-control-btn" aria-label="Music controls" aria-expanded="false" aria-haspopup="true">
                                <i class="fas fa-music"></i>
                            </button>
                            
                            <!-- Volume Control yang selalu terlihat - LEBIH JELAS -->
                            <div class="volume-control-external">
                                <i class="fas fa-volume-up volume-icon-external" id="volumeIconExternal" aria-hidden="true"></i>
                                <input type="range" min="0" max="100" value="50" class="volume-slider-external" id="volumeSliderExternal" aria-label="Volume control">
                            </div>
                            
                            <!-- Music Panel (Hidden by default) - POSISI DIPERBAIKI -->
                            <div id="musicPanel" class="music-panel" role="menu" aria-labelledby="musicControlBtn">
                                <div class="music-options">
                                    <div class="music-option active" data-music="coffee-vibes" role="menuitemradio" aria-checked="true">
                                        <i class="fas fa-coffee"></i>
                                        <span>Coffee Vibes</span>
                                    </div>
                                    <div class="music-option" data-music="lofi-study" role="menuitemradio" aria-checked="false">
                                        <i class="fas fa-headphones"></i>
                                        <span>Lofi Study</span>
                                    </div>
                                    <div class="music-option" data-music="rainy-coding" role="menuitemradio" aria-checked="false">
                                        <i class="fas fa-cloud-rain"></i>
                                        <span>Rainy Coding</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Video Container -->
                    <div class="video-container rounded-2xl overflow-hidden mb-2 relative">
                        <video id="hikariVideo" class="w-full h-full object-cover rounded-2xl" muted playsinline autoplay aria-label="Anime character video background">
                            <source src="./assets/videos/Blue Archive - Hikari Live2D - Jaymie (1080p, h264).mp4" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        
                        <div id="videoFallback" class="video-fallback rounded-2xl">
                            <div class="text-center">
                                <i class="fas fa-video text-4xl text-soft-coral mb-2"></i>
                                <p class="text-sm text-soft-gray/80">Video Placeholder</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Character Companion & Quotes -->
                <section class="glass-card rounded-3xl p-6" aria-labelledby="motivationalQuote">
                    <div class="flex items-center gap-4">
                        <!-- Character -->
                        <div class="character-companion flex-shrink-0" id="characterContainer">
                            <div class="w-20 h-20 bg-gradient-to-br from-soft-coral to-soft-mint rounded-full flex items-center justify-center relative overflow-hidden">
                                <img id="characterImage" src="./assets/images/Hikari_icon.jpg" alt="Character companion Hikari" class="w-full h-full object-cover rounded-full character-image">
                                <div class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center">
                                    <span class="text-white text-xs font-bold" id="characterLevel">1</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Motivational Quote dengan Gambar Karakter -->
                        <div class="flex-1">
                            <div class="flex items-start gap-3">
                                <!-- Gambar karakter kecil di samping quote -->
                                <img id="quoteCharacterImage" src="./assets/images/Hikari_icon.jpg" alt="Quote character" class="w-8 h-8 rounded-full flex-shrink-0 mt-1 quote-character-image">
                                
                                <div class="flex-1">
                                    <div id="motivationalQuote" class="text-soft-gray/80 italic text-sm">
                                        "Every focused minute brings you closer to your dreams! ‚ú®"
                                    </div>
                                    <div class="text-xs text-soft-gray/60 mt-1" id="quoteAuthor">- Your Anime Companion</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Right Column - Timer & Controls -->
            <div class="space-y-6">
                <!-- Timer Card - PERBAIKAN: Container yang lebih aman untuk mobile -->
                <section class="glass-card rounded-3xl p-4 sm:p-6 transform hover:scale-[1.01] transition-all duration-300 relative" aria-labelledby="timerHeading">
                    <h2 id="timerHeading" class="sr-only">Timer Controls</h2>
                    
                    <!-- Session Type Badge -->
                    <div class="text-center mb-4 sm:mb-6">
                        <div class="inline-flex items-center gap-2 px-4 py-2 bg-white/50 rounded-full">
                            <i class="fas fa-clock text-soft-coral text-sm" id="sessionIcon" aria-hidden="true"></i>
                            <span class="text-soft-gray font-bold text-base" id="sessionType">Focus Time</span>
                        </div>
                    </div>

                    <!-- Timer Display - PERBAIKAN: Container dengan padding yang cukup - DIPERBESAR -->
                    <div class="timer-container">
                        <svg class="progress-ring" viewBox="0 0 192 192" aria-hidden="true">
                            <circle
                                class="text-white/40"
                                stroke-width="8"
                                stroke="currentColor"
                                fill="transparent"
                                r="90"
                                cx="96"
                                cy="96"
                            />
                            <circle
                                class="progress-ring-circle text-soft-coral"
                                stroke-width="8"
                                stroke-dasharray="565.48"
                                stroke-dashoffset="0"
                                stroke-linecap="round"
                                stroke="currentColor"
                                fill="transparent"
                                r="90"
                                cx="96"
                                cy="96"
                                id="progressCircle"
                            />
                        </svg>
                        <div class="timer-text">
                            <div class="text-4xl sm:text-5xl font-extrabold text-soft-gray mb-1" id="timerDisplay" aria-live="polite">25:00</div>
                            <div class="text-xs text-soft-gray/80" id="timerStatus" aria-live="polite">Ready to focus</div>
                        </div>
                    </div>

                    <!-- Custom Interval Controls -->
                    <div class="flex justify-center gap-2 mb-4" id="intervalButtonsContainer" role="group" aria-label="Focus time intervals">
                        <button class="interval-btn px-3 py-2 rounded-full text-sm control-btn active" data-minutes="25" aria-label="25 minutes focus time" aria-pressed="true">25min</button>
                        <button class="interval-btn px-3 py-2 rounded-full text-sm control-btn" data-minutes="45" aria-label="45 minutes focus time" aria-pressed="false">45min</button>
                        <button class="interval-btn px-3 py-2 rounded-full text-sm control-btn" data-minutes="60" aria-label="60 minutes focus time" aria-pressed="false">60min</button>
                    </div>

                    <!-- Break Time Controls -->
                    <div class="flex justify-center gap-2 mb-4" id="breakButtonsContainer" role="group" aria-label="Break time intervals">
                        <button class="break-btn px-3 py-2 rounded-full text-sm control-btn active" data-minutes="5" aria-label="5 minutes break" aria-pressed="true">5min break</button>
                        <button class="break-btn px-3 py-2 rounded-full text-sm control-btn" data-minutes="10" aria-label="10 minutes break" aria-pressed="false">10min break</button>
                    </div>

                    <!-- Progress Bar - PERBAIKAN: Bar yang lebih jelas -->
                    <div class="mb-4 sm:mb-6">
                        <div class="progress-bar-visible" style="--progress-width: 0%" id="progressBarVisible" aria-label="Timer progress" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
                    </div>

                    <!-- Control Buttons -->
                    <div class="flex justify-center gap-2 sm:gap-3 mb-4" role="group" aria-label="Timer controls">
                        <button id="startBtn" class="main-btn px-4 sm:px-6 py-2 sm:py-3 text-sm sm:text-base" aria-label="Start timer">
                            <i class="fas fa-play mr-1" aria-hidden="true"></i>Start
                        </button>
                        <button id="pauseBtn" class="secondary-btn px-4 sm:px-6 py-2 sm:py-3 text-sm sm:text-base hidden" aria-label="Pause timer">
                            <i class="fas fa-pause mr-1" aria-hidden="true"></i>Pause
                        </button>
                        <button id="continueBtn" class="main-btn px-4 sm:px-6 py-2 sm:py-3 text-sm sm:text-base hidden" aria-label="Continue timer">
                            <i class="fas fa-play mr-1" aria-hidden="true"></i>Continue
                        </button>
                        <button id="resetBtn" class="secondary-btn px-3 sm:px-5 py-2 sm:py-3 text-sm sm:text-base" aria-label="Reset timer">
                            <i class="fas fa-redo" aria-hidden="true"></i>
                        </button>
                    </div>

                    <!-- Session Info -->
                    <div class="flex justify-center items-center gap-4 sm:gap-6" aria-label="Session statistics">
                        <div class="text-center">
                            <div class="text-lg font-bold text-soft-gray" id="sessionCount" aria-live="polite">0</div>
                            <div class="text-xs text-soft-gray/70">Sessions</div>
                        </div>
                        <div class="text-center">
                            <div class="text-lg font-bold text-soft-gray" id="totalMinutes" aria-live="polite">0</div>
                            <div class="text-xs text-soft-gray/70">Minutes</div>
                        </div>
                    </div>
                </section>

                <!-- Achievements Card -->
                <section class="glass-card rounded-3xl p-6" aria-labelledby="achievementsHeading">
                    <h3 id="achievementsHeading" class="text-lg font-bold text-soft-gray mb-3">Achievements</h3>
                    <div class="grid grid-cols-4 gap-2" role="list" aria-label="Achievements list">
                        <div class="achievement-badge bg-gray-300 rounded-full w-12 h-12 flex items-center justify-center text-lg" title="First Session - Complete your first focus session" data-achievement="firstSession" role="listitem">
                            üî•
                        </div>
                        <div class="achievement-badge bg-gray-300 rounded-full w-12 h-12 flex items-center justify-center text-lg" title="Focus Master - Complete 5 sessions" data-achievement="focusMaster" role="listitem">
                            ‚≠ê
                        </div>
                        <div class="achievement-badge bg-gray-300 rounded-full w-12 h-12 flex items-center justify-center text-lg" title="Marathon Runner - Study for 60+ minutes" data-achievement="marathonRunner" role="listitem">
                            üèÉ
                        </div>
                        <div class="achievement-badge bg-gray-300 rounded-full w-12 h-12 flex items-center justify-center text-lg" title="Early Bird - Start before 8 AM" data-achievement="earlyBird" role="listitem">
                            üåÖ
                        </div>
                    </div>
                </section>

                <!-- Statistics Card -->
                <section class="glass-card rounded-3xl p-6" aria-labelledby="statsHeading">
                    <h3 id="statsHeading" class="text-lg font-bold text-soft-gray mb-3">Today's Stats</h3>
                    <div class="space-y-2" role="list" aria-label="Today's statistics">
                        <div class="flex justify-between text-sm" role="listitem">
                            <span class="text-soft-gray/70">Focus Sessions:</span>
                            <span class="font-bold text-soft-gray" id="statsSessions">0</span>
                        </div>
                        <div class="flex justify-between text-sm" role="listitem">
                            <span class="text-soft-gray/70">Total Time:</span>
                            <span class="font-bold text-soft-gray" id="statsTotalTime">0min</span>
                        </div>
                        <div class="flex justify-between text-sm" role="listitem">
                            <span class="text-soft-gray/70">Productivity:</span>
                            <span class="font-bold text-soft-gray" id="statsProductivity">0%</span>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Audio Elements -->
    <audio id="backgroundMusic" loop aria-label="Background music">
        <source src="./assets/music/coffee-vibes.mp3" type="audio/mpeg">
        <source src="./assets/music/coffee-vibes.ogg" type="audio/ogg">
        Your browser does not support the audio element.
    </audio>
    <audio id="completionSound" aria-label="Completion sound">
        <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2c97c0c6e9.mp3?filename=success-1-6297.mp3" type="audio/mpeg">
    </audio>

    <script>
    // ============================
    // UTILITY FUNCTIONS - DIPERBAIKI
    // ============================

    /**
     * Debounce function untuk performance optimization
     */
    const debounce = (func, wait) => {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    };

    /**
     * Safe error handler yang DIPERBAIKI dengan logging lebih baik
     */
    const safeExecute = async (operation, fallback = null, errorMessage = 'Operation failed') => {
        try {
            return await operation();
        } catch (error) {
            console.error(`${errorMessage}:`, {
                error: error.message,
                stack: error.stack,
                timestamp: new Date().toISOString()
            });
            // Log ke analytics jika ada
            if (typeof gtag !== 'undefined') {
                gtag('event', 'exception', {
                    description: errorMessage,
                    fatal: false
                });
            }
            return fallback;
        }
    };

    /**
     * Robust video player dengan comprehensive error handling
     */
    const playVideoSafely = async (videoElement) => {
        try {
            await videoElement.play();
            return true;
        } catch (error) {
            console.warn('Video autoplay failed, trying with muted:', error);
            
            try {
                videoElement.muted = true;
                await videoElement.play();
                return true;
            } catch (error2) {
                console.error('Video play failed completely:', error2);
                
                const fallback = document.getElementById('videoFallback');
                if (fallback) {
                    fallback.style.display = 'flex';
                }
                
                const tryOnce = () => {
                    videoElement.play().catch(() => {});
                    document.removeEventListener('click', tryOnce);
                };
                document.addEventListener('click', tryOnce);
                
                return false;
            }
        }
    };

    // ============================
    // STATE MANAGEMENT
    // ============================
    
    // Timer State
    let timeLeft = 25 * 60;
    let totalTime = 25 * 60;
    let isRunning = false;
    let isFocusSession = true;
    let timerInterval;
    let sessionCounter = 0;
    let totalMinutesWorked = 0;
    let breakTime = 5 * 60;
    let currentFocusTime = 25 * 60;
    let lastUpdate = performance.now(); // DIPERBAIKI: gunakan performance.now()

    // Settings
    let musicEnabled = false;
    let soundEnabled = true;
    let currentTheme = 'mint';
    let currentMusic = 'coffee-vibes';
    let musicPanelOpen = false;
    let currentVolume = 0.5;

    // Statistics
    let stats = {
        sessionsCompleted: 0,
        totalFocusTime: 0,
        dailyGoal: 4,
        streak: 0
    };

    // Achievements
    let achievements = {
        firstSession: false,
        focusMaster: false,
        marathonRunner: false,
        earlyBird: false
    };

    // Video Sequence Management
    let currentVideoIndex = 0;
    const videoSources = [
        {
            src: "./assets/videos/Blue Archive - Hikari Live2D - Jaymie (1080p, h264).mp4",
            title: "Blue Archive - Hikari",
            subtitle: "Live2D Animation"
        },
        {
            src: "./assets/videos/Blue Archive - Nozomi Live2D - Jaymie (1080p, h264).mp4", 
            title: "Blue Archive - Nozomi",
            subtitle: "Live2D Animation"
        }
    ];

    // Motivational Quotes
    const motivationalQuotes = [
        { 
            text: "U-Um... mari kita fokus sebentar lagi, Sensei! Kita pasti bisa!", 
            author: "Hikari",
            image: "./assets/images/Hikari_icon.jpg"
        },
        { 
            text: "Jangan menyerah... setiap menit yang kita habiskan akan membuahkan hasil!", 
            author: "Hikari",
            image: "./assets/images/Hikari_icon.jpg"
        },
        { 
            text: "Ayo semangat, Sensei! Waktu fokus dimulai! Kita pasti bisa menyelesaikannya! üî•", 
            author: "Nozomi",
            image: "./assets/images/Nozomi_icon.jpg"
        },
        { 
            text: "Mari kita bakar semangat belajar! Nozomi akan mendukung Sensei!", 
            author: "Nozomi",
            image: "./assets/images/Nozomi_icon.jpg"
        },
        { 
            text: "Waktunya istirahat! Ayo kita regangkan badan dan minum sesuatu! üéâ", 
            author: "Nozomi",
            image: "./assets/images/Nozomi_icon.jpg"
        }
    ];

    // Music Options
    const musicOptions = [
        {
            id: 'coffee-vibes',
            name: 'Coffee Vibes',
            icon: 'fa-coffee',
            file: './assets/music/coffee-vibes.mp3'
        },
        {
            id: 'lofi-study',
            name: 'Lofi Study',
            icon: 'fa-headphones',
            file: './assets/music/lofi-study.mp3'
        },
        {
            id: 'rainy-coding',
            name: 'Rainy Coding',
            icon: 'fa-cloud-rain',
            file: './assets/music/rainy-coding.mp3'
        }
    ];

    // ============================
    // DOM ELEMENTS
    // ============================

    // Timer Elements
    const timerDisplay = document.getElementById('timerDisplay');
    const timerStatus = document.getElementById('timerStatus');
    const progressBarVisible = document.getElementById('progressBarVisible');
    const progressCircle = document.getElementById('progressCircle');
    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const continueBtn = document.getElementById('continueBtn');
    const resetBtn = document.getElementById('resetBtn');
    const sessionType = document.getElementById('sessionType');
    const sessionIcon = document.getElementById('sessionIcon');
    const sessionCount = document.getElementById('sessionCount');
    const totalMinutesEl = document.getElementById('totalMinutes');

    // Video Elements
    const videoElement = document.getElementById('hikariVideo');
    const videoFallback = document.getElementById('videoFallback');
    const videoTitle = document.getElementById('videoTitle');
    const videoSubtitle = document.getElementById('videoSubtitle');

    // Audio Elements
    const backgroundMusic = document.getElementById('backgroundMusic');
    const completionSound = document.getElementById('completionSound');
    const musicControlBtn = document.getElementById('musicControlBtn');
    const musicPanel = document.getElementById('musicPanel');
    const volumeSliderExternal = document.getElementById('volumeSliderExternal');
    const volumeIconExternal = document.getElementById('volumeIconExternal');

    // Music Selector Elements
    const musicOptionsElements = document.querySelectorAll('.music-option');

    // Character & Quotes
    const characterContainer = document.getElementById('characterContainer');
    const characterImage = document.getElementById('characterImage');
    const motivationalQuote = document.getElementById('motivationalQuote');
    const quoteAuthor = document.getElementById('quoteAuthor');
    const quoteCharacterImage = document.getElementById('quoteCharacterImage');

    // Theme & Customization
    const themeButtons = document.querySelectorAll('.theme-btn');
    const bodyTheme = document.getElementById('body-theme');

    // Statistics
    const statsSessions = document.getElementById('statsSessions');
    const statsTotalTime = document.getElementById('statsTotalTime');
    const statsProductivity = document.getElementById('statsProductivity');

    // Notifications
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notificationText');
    const achievementPopup = document.getElementById('achievementPopup');
    const achievementIcon = document.getElementById('achievementIcon');
    const achievementTitle = document.getElementById('achievementTitle');
    const achievementDesc = document.getElementById('achievementDesc');

    // Splash Screen
    const splashScreen = document.getElementById('splash-screen');

    // ============================
    // CORE FUNCTIONS
    // ============================

    // Format time for timer
    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    // Update timer display
    function updateDisplay() {
        timerDisplay.textContent = formatTime(timeLeft);
        const progress = ((totalTime - timeLeft) / totalTime) * 100;
        
        // Update progress bar yang jelas
        progressBarVisible.style.setProperty('--progress-width', `${progress}%`);
        progressBarVisible.setAttribute('aria-valuenow', progress);
        
        const circumference = 2 * Math.PI * 90;
        const offset = circumference - (progress / 100) * circumference;
        progressCircle.style.strokeDashoffset = offset;
    }

    // ============================
    // TIMER FUNCTIONS - DIPERBAIKI
    // ============================

    // Performance optimized timer menggunakan requestAnimationFrame DENGAN PERBAIKAN
    function animateTimer() {
        if (!isRunning) return;
        
        const now = performance.now(); // DIPERBAIKI: gunakan performance API
        const delta = now - lastUpdate;
        
        if (delta >= 1000) {
            timeLeft--;
            updateDisplay();
            lastUpdate = now;
            
            // Batch DOM updates untuk performance yang lebih baik
            if (isFocusSession && timeLeft % 60 === 0) {
                totalMinutesWorked++;
                requestAnimationFrame(() => {
                    totalMinutesEl.textContent = totalMinutesWorked;
                    stats.totalFocusTime++;
                    updateStatistics();
                });
            }
            
            if (timeLeft <= 0) {
                isRunning = false;
                completeSession();
                return;
            }
        }
        
        requestAnimationFrame(animateTimer);
    }

    // Start timer dengan performance optimization
    function startTimer() {
        if (isRunning) return;
        
        isRunning = true;
        lastUpdate = performance.now(); // DIPERBAIKI
        startBtn.classList.add('hidden');
        pauseBtn.classList.remove('hidden');
        continueBtn.classList.add('hidden');
        
        timerStatus.textContent = isFocusSession ? 'Stay focused!' : 'Take a break!';
        
        // Update character animation
        characterContainer.classList.add('character-talking');
        setTimeout(() => characterContainer.classList.remove('character-talking'), 500);
        
        animateTimer();
    }

    // Pause timer
    function pauseTimer() {
        if (!isRunning) return;
        
        isRunning = false;
        pauseBtn.classList.add('hidden');
        continueBtn.classList.remove('hidden');
        timerStatus.textContent = 'Paused';
    }

    // Continue timer
    function continueTimer() {
        if (isRunning) return;
        
        isRunning = true;
        lastUpdate = performance.now(); // DIPERBAIKI
        continueBtn.classList.add('hidden');
        pauseBtn.classList.remove('hidden');
        timerStatus.textContent = isFocusSession ? 'Stay focused!' : 'Take a break!';
        
        animateTimer();
    }

    // Reset timer
    function resetTimer() {
        isRunning = false;
        timeLeft = isFocusSession ? currentFocusTime : breakTime;
        totalTime = isFocusSession ? currentFocusTime : breakTime;
        updateDisplay();
        
        // Reset button states
        startBtn.classList.remove('hidden');
        pauseBtn.classList.add('hidden');
        continueBtn.classList.add('hidden');
        
        timerStatus.textContent = isFocusSession ? 'Ready to focus' : 'Ready for break';
    }

    // ============================
    // PERBAIKAN: BUTTON FUNCTIONS dengan error handling lebih baik
    // ============================

    // Change interval dengan debounce
    const changeInterval = debounce(function(minutes) {
        currentFocusTime = minutes * 60;
        
        if (isFocusSession) {
            if (isRunning) {
                timeLeft = currentFocusTime;
                totalTime = currentFocusTime;
            } else {
                timeLeft = currentFocusTime;
                totalTime = currentFocusTime;
            }
            updateDisplay();
        }
        
        // Update active interval button
        document.querySelectorAll('.interval-btn').forEach(btn => {
            const btnMinutes = parseInt(btn.dataset.minutes);
            const isActive = btnMinutes === minutes;
            btn.classList.toggle('active', isActive);
            btn.setAttribute('aria-pressed', isActive.toString());
        });

        showNotification('clock', `Focus time set to ${minutes} minutes`);
    }, 300);

    // Change break time dengan debounce
    const changeBreakTime = debounce(function(minutes) {
        breakTime = minutes * 60;
        
        if (!isFocusSession) {
            if (isRunning) {
                timeLeft = breakTime;
                totalTime = breakTime;
            } else {
                timeLeft = breakTime;
                totalTime = breakTime;
            }
            updateDisplay();
        }
        
        // Update active break button
        document.querySelectorAll('.break-btn').forEach(btn => {
            const btnMinutes = parseInt(btn.dataset.minutes);
            const isActive = btnMinutes === minutes;
            btn.classList.toggle('active', isActive);
            btn.setAttribute('aria-pressed', isActive.toString());
        });

        showNotification('coffee', `Break time set to ${minutes} minutes`);
    }, 300);

    // ============================
    // CSS PERBAIKAN UNTUK MOBILE EXTREME
    // ============================

    // Tambahkan CSS untuk mobile extreme (iPhone SE)
    const mobileOptimizationCSS = `
        @media (max-width: 320px) {
            .timer-container {
                min-height: 140px !important; /* JAMIN MINIMAL SIZE */
                height: clamp(140px, 25vw, 160px) !important;
            }
            
            .progress-ring {
                width: clamp(120px, 22vw, 140px) !important;
                height: clamp(120px, 22vw, 140px) !important;
            }
            
            .timer-text {
                padding: 0.25rem !important;
            }
            
            .text-4xl, .text-5xl {
                font-size: 2rem !important;
            }
            
            /* Pastikan touch target cukup besar */
            .control-btn, .main-btn, .secondary-btn {
                min-height: 44px !important;
                min-width: 44px !important;
            }
            
            /* Optimasi spacing untuk device kecil */
            .space-y-6 > * {
                margin-top: 0.5rem !important;
                margin-bottom: 0.5rem !important;
            }
        }
        
        @media (max-width: 280px) {
            /* Untuk device yang sangat kecil */
            .timer-container {
                min-height: 130px !important;
                height: clamp(130px, 20vw, 150px) !important;
            }
            
            .progress-ring {
                width: clamp(110px, 20vw, 130px) !important;
                height: clamp(110px, 20vw, 130px) !important;
            }
            
            .text-4xl, .text-5xl {
                font-size: 1.75rem !important;
            }
        }
    `;

    // Inject CSS untuk mobile optimization
    function injectMobileOptimizationCSS() {
        const style = document.createElement('style');
        style.textContent = mobileOptimizationCSS;
        document.head.appendChild(style);
    }

    // ============================
    // PERBAIKAN: MUSIC CONTROL FUNCTIONS
    // ============================

    // Toggle music panel
    function toggleMusicPanel() {
        musicPanelOpen = !musicPanelOpen;
        
        if (musicPanelOpen) {
            musicPanel.classList.add('show');
            musicControlBtn.classList.add('active');
            musicControlBtn.setAttribute('aria-expanded', 'true');
            musicControlBtn.style.transform = 'scale(1.1)';
        } else {
            musicPanel.classList.remove('show');
            musicControlBtn.classList.remove('active');
            musicControlBtn.setAttribute('aria-expanded', 'false');
            musicControlBtn.style.transform = '';
        }
    }

    // Function toggle music yang lebih smooth
    function toggleMusic() {
        musicEnabled = !musicEnabled;
        
        if (musicEnabled) {
            backgroundMusic.volume = currentVolume;
            safeExecute(
                () => backgroundMusic.play(),
                null,
                'Background music play failed'
            ).then(success => {
                if (!success) {
                    showNotification('info', 'Click anywhere to enable music');
                    document.addEventListener('click', function tryPlayOnce() {
                        safeExecute(() => backgroundMusic.play());
                        document.removeEventListener('click', tryPlayOnce);
                    });
                }
            });
            
            musicControlBtn.innerHTML = '<i class="fas fa-music"></i>';
            musicControlBtn.classList.add('active');
            showNotification('music', 'Music enabled üéµ');
            
        } else {
            backgroundMusic.pause();
            musicControlBtn.innerHTML = '<i class="fas fa-music"></i>';
            musicControlBtn.classList.remove('active');
            showNotification('music', 'Music disabled üîá');
        }
        
        saveSettings();
    }

    // Function change music yang diperbaiki
    function changeMusic(musicId) {
        currentMusic = musicId;
        
        // Update UI music options
        musicOptionsElements.forEach(option => {
            const isActive = option.dataset.music === musicId;
            option.classList.toggle('active', isActive);
            option.setAttribute('aria-checked', isActive.toString());
        });
        
        // Change music source
        const selectedMusic = musicOptions.find(m => m.id === musicId);
        if (selectedMusic) {
            const wasPlaying = !backgroundMusic.paused;
            
            backgroundMusic.pause();
            backgroundMusic.src = selectedMusic.file;
            backgroundMusic.volume = currentVolume;
            
            if (wasPlaying && musicEnabled) {
                safeExecute(() => backgroundMusic.play());
            }
            
            showNotification('music', `Now playing: ${selectedMusic.name} üéß`);
        }
        
        saveSettings();
    }

    // Volume control yang lebih smooth untuk volume external
    const updateVolumeExternal = debounce(function(value) {
        currentVolume = value / 100;
        backgroundMusic.volume = currentVolume;
        completionSound.volume = currentVolume;
        
        // Update volume icon dengan animation
        if (value == 0) {
            volumeIconExternal.className = 'fas fa-volume-mute volume-icon-external';
            volumeIconExternal.style.transform = 'scale(1.1)';
        } else if (value < 30) {
            volumeIconExternal.className = 'fas fa-volume-down volume-icon-external';
            volumeIconExternal.style.transform = 'scale(1.05)';
        } else if (value < 70) {
            volumeIconExternal.className = 'fas fa-volume-up volume-icon-external';
            volumeIconExternal.style.transform = '';
        } else {
            volumeIconExternal.className = 'fas fa-volume-up volume-icon-external';
            volumeIconExternal.style.transform = 'scale(1.1)';
        }
        
        setTimeout(() => {
            volumeIconExternal.style.transform = '';
        }, 200);
        
        saveSettings();
    }, 100);

    // Close music panel
    function closeMusicPanel() {
        musicPanelOpen = false;
        musicPanel.classList.remove('show');
        musicControlBtn.classList.remove('active');
        musicControlBtn.setAttribute('aria-expanded', 'false');
        musicControlBtn.style.transform = '';
    }

    // ============================
    // SETTINGS MANAGEMENT
    // ============================

    function saveSettings() {
        const settings = {
            theme: currentTheme,
            musicEnabled: musicEnabled,
            soundEnabled: soundEnabled,
            volume: currentVolume,
            currentMusic: currentMusic,
            achievements: achievements,
            stats: stats
        };
        try {
            localStorage.setItem('animePomodoroSettings', JSON.stringify(settings));
        } catch (error) {
            console.error('Failed to save settings:', error);
        }
    }

    function loadSettings() {
        try {
            const saved = localStorage.getItem('animePomodoroSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                
                // Apply settings dengan error handling
                if (settings.theme) changeTheme(settings.theme);
                if (settings.musicEnabled !== undefined) musicEnabled = settings.musicEnabled;
                if (settings.volume !== undefined) {
                    currentVolume = settings.volume;
                    volumeSliderExternal.value = currentVolume * 100;
                    updateVolumeExternal(volumeSliderExternal.value);
                }
                if (settings.currentMusic) changeMusic(settings.currentMusic);
                if (settings.achievements) achievements = {...achievements, ...settings.achievements};
                if (settings.stats) stats = {...stats, ...settings.stats};
                
                // Update UI berdasarkan settings
                updateMusicUI();
                
            }
        } catch (e) {
            console.error('Error loading settings:', e);
        }
    }

    function updateMusicUI() {
        // Update music button state
        if (musicEnabled) {
            musicControlBtn.innerHTML = '<i class="fas fa-music"></i>';
            musicControlBtn.classList.add('active');
        } else {
            musicControlBtn.innerHTML = '<i class="fas fa-music"></i>';
            musicControlBtn.classList.remove('active');
        }
        
        // Update music options
        musicOptionsElements.forEach(option => {
            const isActive = option.dataset.music === currentMusic;
            option.classList.toggle('active', isActive);
            option.setAttribute('aria-checked', isActive.toString());
        });
    }

    // ============================
    // VIDEO FUNCTIONS
    // ============================

    // Initialize video dengan comprehensive error handling
    function initializeVideo() {
        // Hide fallback when video loads successfully
        videoElement.addEventListener('loadeddata', () => {
            videoFallback.style.display = 'none';
        });

        // Handle video end event untuk lanjut ke video berikutnya
        videoElement.addEventListener('ended', () => {
            loadNextVideo();
        });

        // Show fallback if video fails to load
        videoElement.addEventListener('error', () => {
            console.error('Video loading error');
            videoFallback.style.display = 'flex';
        });

        // Auto play video pertama setelah splash screen
        setTimeout(() => {
            if (videoElement.paused) {
                playVideoSafely(videoElement);
            }
        }, 3500);
    }

    // Load next video in sequence dengan error handling
    function loadNextVideo() {
        try {
            currentVideoIndex = (currentVideoIndex + 1) % videoSources.length;
            const nextVideo = videoSources[currentVideoIndex];
            
            videoElement.src = nextVideo.src;
            videoTitle.textContent = nextVideo.title;
            videoSubtitle.textContent = nextVideo.subtitle;
            
            // Update character image based on current video
            if (nextVideo.title.includes('Hikari')) {
                characterImage.src = "./assets/images/Hikari_icon.jpg";
                characterImage.alt = "Character companion Hikari";
            } else if (nextVideo.title.includes('Nozomi')) {
                characterImage.src = "./assets/images/Nozomi_icon.jpg";
                characterImage.alt = "Character companion Nozomi";
            }
            
            playVideoSafely(videoElement);
        } catch (error) {
            console.error('Error loading next video:', error);
            videoFallback.style.display = 'flex';
        }
    }

    // ============================
    // FEATURE FUNCTIONS
    // ============================

    // Change motivational quote dengan gambar karakter
    function changeMotivationalQuote() {
        try {
            const randomQuote = motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
            motivationalQuote.textContent = randomQuote.text;
            quoteAuthor.textContent = `- ${randomQuote.author}`;
            quoteCharacterImage.src = randomQuote.image;
            quoteCharacterImage.alt = `Quote character ${randomQuote.author}`;
        } catch (error) {
            console.error('Error changing motivational quote:', error);
        }
    }

    // Change theme
    function changeTheme(theme) {
        currentTheme = theme;
        bodyTheme.className = `min-h-screen py-8 px-4 theme-transition theme-${theme}`;
        
        themeButtons.forEach(btn => {
            const isActive = btn.dataset.theme === theme;
            btn.classList.toggle('border-2', isActive);
            btn.classList.toggle('border-white', isActive);
            btn.setAttribute('aria-pressed', isActive.toString());
        });
        
        saveSettings();
    }

    // Update statistics
    function updateStatistics() {
        try {
            statsSessions.textContent = stats.sessionsCompleted;
            statsTotalTime.textContent = `${stats.totalFocusTime}min`;
            
            const productivity = Math.min(100, Math.floor((stats.sessionsCompleted / stats.dailyGoal) * 100));
            statsProductivity.textContent = `${productivity}%`;
            
            saveSettings();
        } catch (error) {
            console.error('Error updating statistics:', error);
        }
    }

    // Complete session
    function completeSession() {
        // Play completion sound dengan error handling
        if (soundEnabled) {
            safeExecute(() => {
                completionSound.volume = currentVolume;
                return completionSound.play();
            });
        }
        
        try {
            if (isFocusSession) {
                stats.sessionsCompleted++;
                sessionCounter++;
                sessionCount.textContent = sessionCounter;
                updateStatistics();
                checkAchievements();
                showNotification('bell', 'Great work! Time for a break! üéâ');
            } else {
                showNotification('coffee', 'Break over! Ready to focus! üí™');
            }
            
            isFocusSession = !isFocusSession;
            timeLeft = isFocusSession ? currentFocusTime : breakTime;
            totalTime = isFocusSession ? currentFocusTime : breakTime;
            
            sessionType.textContent = isFocusSession ? 'Focus Time' : 'Break Time';
            sessionIcon.className = isFocusSession ? 'fas fa-clock text-soft-coral text-sm' : 'fas fa-coffee text-soft-coral text-sm';
            
            updateDisplay();
            
            // Reset button states setelah session complete
            startBtn.classList.remove('hidden');
            pauseBtn.classList.add('hidden');
            continueBtn.classList.add('hidden');
            
            timerStatus.textContent = isFocusSession ? 'Ready to focus' : 'Ready for break';
            
            changeMotivationalQuote();
        } catch (error) {
            console.error('Error completing session:', error);
        }
    }

    // Check achievements
    function checkAchievements() {
        try {
            if (!achievements.firstSession && stats.sessionsCompleted >= 1) {
                unlockAchievement('firstSession', 'üî•', 'First Session!', 'Complete your first focus session');
            }
            if (!achievements.focusMaster && stats.sessionsCompleted >= 5) {
                unlockAchievement('focusMaster', '‚≠ê', 'Focus Master!', 'Complete 5 focus sessions');
            }
            if (!achievements.marathonRunner && stats.totalFocusTime >= 60) {
                unlockAchievement('marathonRunner', 'üèÉ', 'Marathon Runner!', 'Study for 60+ minutes');
            }
        } catch (error) {
            console.error('Error checking achievements:', error);
        }
    }

    // Unlock achievement
    function unlockAchievement(achievementId, icon, title, description) {
        try {
            achievements[achievementId] = true;
            achievementIcon.textContent = icon;
            achievementTitle.textContent = title;
            achievementDesc.textContent = description;
            achievementPopup.classList.remove('hidden');
            
            const badge = document.querySelector(`[data-achievement="${achievementId}"]`);
            if (badge) {
                badge.classList.add('unlocked');
                badge.classList.remove('bg-gray-300');
                badge.classList.add('bg-yellow-400');
            }
            
            setTimeout(() => {
                achievementPopup.classList.add('hidden');
            }, 3000);
            
            saveSettings();
        } catch (error) {
            console.error('Error unlocking achievement:', error);
        }
    }

    // Show notification
    function showNotification(icon, message) {
        try {
            const notifText = notificationText.querySelector('span');
            const notifIcon = notificationText.querySelector('i');
            notifIcon.className = `fas fa-${icon}`;
            notifText.textContent = message;
            notification.classList.remove('hidden');
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        } catch (error) {
            console.error('Error showing notification:', error);
        }
    }

    // ============================
    // SPLASH SCREEN FUNCTIONS
    // ============================

    function handleSplashImageError() {
        try {
            const container = document.querySelector('.splash-character-container');
            if (container) {
                container.innerHTML = `
                    <div class="splash-character-fallback">
                        <i class="fas fa-user-friends"></i>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error handling splash image error:', error);
        }
    }

    function preloadSplashImage() {
        try {
            const img = new Image();
            img.src = "./assets/images/TachibanaHikari_and_TachibanaNozomi.jpg";
            img.onload = function() {
                console.log('Splash image loaded successfully');
            };
            img.onerror = function() {
                handleSplashImageError();
            };
        } catch (error) {
            console.error('Error preloading splash image:', error);
            handleSplashImageError();
        }
    }

    function hideSplashScreen() {
        try {
            splashScreen.style.opacity = '0';
            splashScreen.style.transform = 'scale(1.1)';
            
            setTimeout(() => {
                splashScreen.style.display = 'none';
                document.querySelectorAll('.page-transition').forEach(el => {
                    el.classList.add('page-loaded');
                });
            }, 1000);
        } catch (error) {
            console.error('Error hiding splash screen:', error);
            splashScreen.style.display = 'none';
        }
    }

    // ============================
    // PERBAIKAN: EVENT LISTENERS
    // ============================

    function initializeMusicEvents() {
        // Music control button dengan better handling
        musicControlBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            toggleMusicPanel();
        });

        // Double click untuk toggle music
        musicControlBtn.addEventListener('dblclick', function(e) {
            e.stopPropagation();
            e.preventDefault();
            toggleMusic();
        });

        // Music options selection
        musicOptionsElements.forEach(option => {
            option.addEventListener('click', function(e) {
                e.stopPropagation();
                const musicId = this.dataset.music;
                changeMusic(musicId);
                
                // Close panel setelah select (optional)
                setTimeout(() => {
                    closeMusicPanel();
                }, 800);
            });
        });

        // Volume control external dengan debounce
        volumeSliderExternal.addEventListener('input', function(e) {
            updateVolumeExternal(this.value);
        });

        // Click outside untuk close panel
        document.addEventListener('click', function(e) {
            if (musicPanelOpen && 
                !musicPanel.contains(e.target) && 
                !musicControlBtn.contains(e.target)) {
                closeMusicPanel();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && musicPanelOpen) {
                closeMusicPanel();
            }
        });
    }

    function initializeEventListeners() {
        console.log('Initializing event listeners...');
        
        // Timer Events
        startBtn.addEventListener('click', startTimer);
        pauseBtn.addEventListener('click', pauseTimer);
        continueBtn.addEventListener('click', continueTimer);
        resetBtn.addEventListener('click', resetTimer);

        // Music Events
        initializeMusicEvents();

        // Theme Events
        themeButtons.forEach(btn => {
            btn.addEventListener('click', () => changeTheme(btn.dataset.theme));
        });

        // Interval buttons dengan debounce
        document.querySelectorAll('.interval-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const minutes = parseInt(this.getAttribute('data-minutes'));
                changeInterval(minutes);
            });
        });

        // Break buttons dengan debounce
        document.querySelectorAll('.break-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const minutes = parseInt(this.getAttribute('data-minutes'));
                changeBreakTime(minutes);
            });
        });

        // Character click event
        characterContainer.addEventListener('click', () => {
            characterContainer.classList.add('character-talking');
            setTimeout(() => characterContainer.classList.remove('character-talking'), 500);
            changeMotivationalQuote();
        });

        console.log('Event listeners initialized successfully');
    }

    // ============================
    // INITIALIZATION - DIPERBAIKI
    // ============================

    function initializeApp() {
        try {
            // 1. Inject mobile optimization CSS
            injectMobileOptimizationCSS();
            
            // 2. Preload resources
            preloadSplashImage();
            
            // 3. Initialize display
            updateDisplay();
            
            // 4. Initialize video
            initializeVideo();
            
            // 5. Load saved settings
            loadSettings();
            
            // 6. Initialize event listeners
            initializeEventListeners();
            
            // 7. Set initial states
            changeMotivationalQuote();
            updateStatistics();
            changeMusic('coffee-vibes');
            updateVolumeExternal(50);

            // 8. Set initial audio state
            backgroundMusic.volume = currentVolume;
            completionSound.volume = currentVolume;

            console.log('Pomodoro Timer initialized successfully!');
            
            // 9. Hide splash screen setelah semua diinisialisasi
            setTimeout(hideSplashScreen, 3000);
        } catch (error) {
            console.error('Error initializing app:', error);
            // Fallback: langsung hide splash screen
            setTimeout(() => {
                if (splashScreen) {
                    splashScreen.style.display = 'none';
                }
                document.querySelectorAll('.page-transition').forEach(el => {
                    el.classList.add('page-loaded');
                });
            }, 1000);
        }
    }

    // Start the app dengan error handling yang DIPERBAIKI
    document.addEventListener('DOMContentLoaded', function() {
        safeExecute(initializeApp, null, 'App initialization failed');
    });
</script>
</body>
</html>